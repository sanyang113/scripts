var status = 0;
var qty = 1;

var items = [
	2049310, 2049310, 2049310, 2049310, 2049310, //混卷5%
	2049210, 2049210, 2049210, 2049210, 2049210, 2049210, 2049210, 2049210, 2049210, 2049210, //基礎附魔石10%
	2250000, 2250000, 2250000, 2250000, 2250000, 2250000, 2250000, 2250000, 2250000, 2250000, //100萬楓票
	2450000, 2450008, 2450008, 2450008,
	5350000, 5350000, 5350000, 5350000,
	5350000, 5350000, 5350000, 5350000, 5350000, 5350000, 5350000, 5350000, 5350000, 5350000, //高級魚餌20%
	5072000, 5072000, 5072000, 5072000, 5072000, 5072000, 5072000, 5072000, 5072000, 5072000, //高效能喇叭
	5073000, 5073000, 5073000, 5073000, 5073000, 5073000, 5073000, 5073000, 5073000, 5073000, //愛心喇叭
	5074000, 5074000, 5074000, 5074000, 5074000, 5074000, 5074000, 5074000, 5074000, 5074000, //骷髏喇叭
	5561000, 5561000, 5561000, 5561000, 5561000, 5561000, 5561000, 5561000, 5561000, 5561000, //高級任意門
	5041000, 5041000, 5041000, 5041000, 5041000, 5041000, 5041000, 5041000, 5041000, 5041000, //高級傳送石
	1112413, 1112413, 1112413, 1112413, 1112413,
	1112414,
];

var topItems = [
	3010007,3010008,3010010,3010016,3010017, //海豹椅子
	4039503,4039503,4039503,4039503,4039503,4039506, //基礎/高階命運卡
	4039513,4039513,4039513,4039513,4039513,4039514,4039514,4039515,4039516, //混卷命運卡
	2049200,2049200,2049200,2049200,2049200,2049300,2049300,2049300,2049300,2049300, //基礎 普混
	4039000,4039006,4039012,4039018,4039024,4039030,4039036,4039042,4039048,4039054, //佩沙
	4039503,4039503,4039503,4039503,4039503,4039506, //基礎/高階命運卡
	4039513,4039513,4039513,4039513,4039513,4039514,4039514,4039515,4039516, //混卷命運卡
	2049200,2049200,2049200,2049200,2049200,2049300,2049300,2049300,2049300,2049300, //基礎 普混
	4039000,4039006,4039012,4039018,4039024,4039030,4039036,4039042,4039048,4039054, //佩沙
	4039503,4039503,4039503,4039503,4039503,4039506, //基礎/高階命運卡
	4039513,4039513,4039513,4039513,4039513,4039514,4039514,4039515,4039516, //混卷命運卡
	2049200,2049200,2049200,2049200,2049200,2049300,2049300,2049300,2049300,2049300, //基礎 普混
	4039000,4039006,4039012,4039018,4039024,4039030,4039036,4039042,4039048,4039054, //佩沙
	4039503,4039503,4039503,4039503,4039503,4039506, //基礎/高階命運卡
	4039513,4039513,4039513,4039513,4039513,4039514,4039514,4039515,4039516, //混卷命運卡
	2049200,2049200,2049200,2049200,2049200,2049300,2049300,2049300,2049300,2049300, //基礎 普混
	4039000,4039006,4039012,4039018,4039024,4039030,4039036,4039042,4039048,4039054, //佩沙
	4039503,4039503,4039503,4039503,4039503,4039506, //基礎/高階命運卡
	4039513,4039513,4039513,4039513,4039513,4039514,4039514,4039515,4039516, //混卷命運卡
	2049200,2049200,2049200,2049200,2049200,2049300,2049300,2049300,2049300,2049300, //基礎 普混
	4039000,4039006,4039012,4039018,4039024,4039030,4039036,4039042,4039048,4039054 //佩沙
];


function start() {
	status = -1;
	action(1, 0, 0);
}

function action(mode, type, selection) {
	if (mode == -1 || mode == 0) {
		cm.dispose();
	} else {
		status++;
		if (status == 0) {
			cm.sendSimple("嗨，我是#p9000003#，需要什麼幫忙嗎？？\r\n#L0#我拿到寶箱了。");
		} else if (status == 1) {
			if(cm.haveItem(4031017)){
				cm.removeAll(4031017);
				gainItem();
				var prize = cm.getChannelServer().getCurrEvent().getNextPrizeCount();
				if(prize <= 3) {
					gainTopPrizes();
					cm.broadcastTimeEvent("尋寶",prize);
				}
				cm.warp(109050000, 0);
				cm.dispose();
			} else {
				cm.sendOk("你沒有#b#t4031017##k，你來找我做什麼？？");
				cm.dispose();
			}
			cm.dispose();
		}
	}
}

function gainItem() {
    var random = Math.floor(Math.random() * items.length);
	qty = calculateQty(items[random]);
    cm.getPlayer().gainItemName(items[random],qty);
}

function gainTopPrizes() {
	var random = Math.floor(Math.random() * topItems.length);
    cm.getPlayer().gainItemName(topItems[random],1);
}

function calculateQty(itemid) {
	switch(itemid) {
		case 5041000:
		case 5561000:
			return 3;
		case 5074000:
		case 5073000:
		case 5072000:
		case 5350000:
			return 5;
		default:
			return 1;
	}
	return 1;
}